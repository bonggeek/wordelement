<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Word Element</title>
<meta charset="UTF-8">
<meta name="Description" content="Free website to analyze words to locate elements in them for fun and science">
<meta name="author" content="Abhinaba Basu">

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" media="screen and (orientation:portrait)" type="text/css" href="small.css" />
<link rel="stylesheet" media="screen and (min-width:200px) and (max-width: 799px)" type="text/css" href="small.css" />
<link rel="stylesheet" media="screen and (min-width: 800px)" type="text/css" href="default.css" />
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">

    // Create the XHR object.
    function createCORSRequest(method, url) {
        var xhr = new XMLHttpRequest();
        if ("withCredentials" in xhr) {
            // XHR for Chrome/Firefox/Opera/Safari.
            xhr.open(method, url, true);
        } else if (typeof XDomainRequest != "undefined") {
            // XDomainRequest for IE.
            xhr = new XDomainRequest();
            xhr.open(method, url);
        } else {
            // CORS not supported.
            xhr = null;
        }
        return xhr;
    }


    // Make the actual CORS request.
    function fetchElement() {
        var words=document.getElementById('WordBox').value;
        $("#ResultImgDiv").empty();
        $("#ResultDiv").empty();
        $("#ResultImgDiv").hide();
        // This is a sample server that supports CORS.
        var url = 'http://elemental.eastus.cloudapp.azure.com?words=' + words;
        var xhr = createCORSRequest('GET', url);
        if (!xhr) {
            alert('CORS not supported');
            return;
        }

        // Response handlers.
        xhr.onload = function() {
            var text = xhr.responseText;
            var res = JSON.parse(text);
            if (res.length == 0){
                return;
            }
            var str = '';
            for (var i=0; i < res.length; i++){
                var r = res[i];
                str += '<h3>';
                str += r.Word;
                str += '</h3>';
                str += '<br>';
                
                for(var j = 0; j < r.Elements.length; j++){
                    var e = r.Elements[j];
                    str += '<sup>' + e.AtNumber + '</sup>';
                    str += e.Symbol;
                    str += ' ';
                    
                    var elem = document.createElement("img");
                    elem.className = "ImageElement";
                    elem.setAttribute("src", "./images/" + e.AtNumber + ".jpg");
                    elem.setAttribute("alt", e.Name);
                    $("#ResultImgDiv").append(elem);
                }

                $("#ResultImgDiv").append('<br>');
                $("#ResultImgDiv").fadeIn(2000);

                str += '\r\n';
            }

            //$("#ResultDiv").html(str);

        };
        
        xhr.onerror = function() {
            $("#ResultDiv").html('<h3>Woops, there was an error making the request</h3>');
        };

        xhr.send();
    }

    // function to hook up enter key on word box to fetch elements
    $(function() {
        $("#WordBox").keypress(function (e) {
            if ((e.which && e.which == 13) || (e.keyCode && e.keyCode == 13)) {
                fetchElement()
                return false;
            } else {
                return true;
            }
        });
    });


</script>
</head>

<body>
    <div id="mainDiv">
        <img id="BannerImg" src="./banner.png" />
        <div id="InputDiv">
            <p id="DescriptionText">Enter a word or name and see what it is made of</p>
            <input type="text" id="WordBox" placeholder="Type a word"/>
            <button id="WordButton" onclick="fetchElement()">Get Elements</button>
        </div>
        <div id="ResultImgDiv"></div>
        <div id="ResultDiv"></div>
   </div>
 </body>
</html>
